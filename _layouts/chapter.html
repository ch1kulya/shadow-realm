---
layout: default
---
<div class="reader-container" data-chapter-url="{{ page.url }}" data-chapter-title="{{ page.title | escape }}" data-chapter-number="{{ page.chapter_number }}">
  <!-- 1. Липкий хедер -->
  <header class="reader-header">
    <div class="header-buttons">
      <button class="header-btn" data-panel-id="toc-panel" title="Содержание">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
      </button>
      <button class="header-btn" id="bookmark-btn" title="Добавить в закладки">
        <svg class="bookmark-icon-outline" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>
        <svg class="bookmark-icon-filled" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>
      </button>
      <button class="header-btn" data-panel-id="settings-panel" title="Настройки">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg>
      </button>
    </div>

    <!-- Панели внутри хедера -->
    <div id="panels-container">
      <div id="toc-panel" class="panel">
        <div class="panel-content">
          <div class="toc-controls">
            <input type="text" placeholder="Поиск главы..." class="search-input">
            <button class="sort-btn" title="Сортировать">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7h18M3 12h12M3 17h6"/></svg>
            </button>
          </div>
          <ul class="chapters-list">
            <!-- Список глав будет динамически загружен сюда -->
          </ul>
        </div>
      </div>

      <!-- Панель: Настройки (переработанная) -->
      <div id="settings-panel" class="panel">
        <div class="panel-content">
          <div class="setting-row">
            <div class="settings-group">
              <span class="setting-label">Тема</span>
              <div class="icon-group">
                <button data-setting="theme" data-value="light" title="Светлая тема">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                  </svg>
                </button>
                <button data-setting="theme" data-value="dark" title="Тёмная тема">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                  </svg>
                </button>
                <button data-setting="theme" data-value="system" title="Системная тема">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                    <line x1="8" y1="21" x2="16" y2="21"></line>
                    <line x1="12" y1="17" x2="12" y2="21"></line>
                  </svg>
                </button>
              </div>
            </div>
            <div class="settings-group">
              <span class="setting-label">Шрифт</span>
              <div class="custom-select-wrapper">
                <select data-setting="font" class="font-select">
                  <option value="lora" style="font-family:'Lora', serif;">Lora</option>
                  <option value="inter" style="font-family:'Inter', sans-serif;">Inter</option>
                  <option value="merriweather" style="font-family:'Merriweather', serif;">Merriweather</option>
                  <option value="roboto" style="font-family:'Roboto', sans-serif;">Roboto</option>
                </select>
              </div>
            </div>
          </div>

          <div class="settings-group">
            <span class="setting-label">Размер шрифта</span>
            <div class="slider-wrapper">
              <span class="font-size-label-sm">A</span>
              <input type="range" data-setting="font-size" min="0.875" max="1.5" step="0.0625" value="1.125">
              <span class="font-size-label-lg">A</span>
            </div>
          </div>

          <div class="setting-row">
            <div class="settings-group">
              <span class="setting-label">Выравнивание</span>
              <div class="icon-group">
                <button data-setting="align" data-value="left" title="По левому краю">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="12" x2="16" y2="12"></line><line x1="4" y1="18" x2="20" y2="18"></line>
                  </svg>
                </button>
                <button data-setting="align" data-value="justify" title="По ширине">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="12" x2="20" y2="12"></line><line x1="4" y1="18" x2="20" y2="18"></line>
                  </svg>
                </button>
              </div>
            </div>
            <div class="settings-group">
              <span class="setting-label">Отступ</span>
              <div class="icon-group">
                <button data-setting="indent" data-value="0" title="Без отступа">0</button>
                <button data-setting="indent" data-value="2" title="Средний отступ">2</button>
                <button data-setting="indent" data-value="3" title="Большой отступ">3</button>
              </div>
            </div>
          </div>

          <div class="settings-group">
            <span class="setting-label">Офлайн-доступ</span>
            <button id="offline-download-btn" class="btn-full-width">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-mr">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Кэшировать
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- 2. Основной контент (текст главы) -->
  <main class="reader-main">
    <article class="chapter-content">
      <h1>Глава {{ page.chapter_number }}: {{ page.title }}</h1>
      {{ content }}
    </article>
    <div id="content-end-sentinel"></div>

    <div class="floating-nav">
      {% if page.previous %}
        <a href="{{ page.previous.url | relative_url }}" class="nav-arrow" title="Предыдущая глава">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
        </a>
      {% else %}
        <div></div> <!-- Пустой div для сохранения justify-content: space-between -->
      {% endif %}

      {% if page.next %}
         <a href="{{ page.next.url | relative_url }}" class="nav-arrow" title="Следующая глава">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
        </a>
      {% endif %}
    </div>
  </main>
  <div class="reader-footer">© ch1ka 2025</div>

  <!-- Оверлей для закрытия панелей -->
  <div class="panel-overlay"></div>
</div>
<script src="{{ '/assets/js/build-size.js' | relative_url }}" defer></script>